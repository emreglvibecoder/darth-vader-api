<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Vader's Command Center 2.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Poller+One&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: #ffe81f; font-family: 'Poller One', cursive; text-align: center; padding: 20px; }
        .card { background: rgba(20, 20, 20, 0.9); padding: 20px; border: 2px solid #ffe81f; box-shadow: 0 0 15px #ffe81f; margin: 10px auto; max-width: 400px; }
        input { width: 80%; padding: 10px; margin: 5px; background: #111; border: 1px solid #ffe81f; color: white; }
        button { padding: 10px 20px; background: #ffe81f; border: none; cursor: pointer; font-weight: bold; margin: 5px; }
        button:hover { background: white; box-shadow: 0 0 10px white; }
        #app-area { display: none; } /* Giriş yapmadan görünmez */
        li { background: #222; margin: 5px; padding: 10px; border-left: 5px solid #f00; display: flex; justify-content: space-between; transition: 0.3s; }
        li:hover { border-left-width: 20px; } /* Işın kılıcı uzama efekti */
    </style>
</head>
<body>

    <audio id="sndSaberOn" src="https://www.soundboard.com/handler/DownLoadTrack.ashx?cliptoken=5d85d77a-6242-45e0-8c90-9f5b6b3e896a"></audio>
    <audio id="sndSaberSwing" src="https://www.soundboard.com/handler/DownLoadTrack.ashx?cliptoken=f98897c8-2b87-43f1-b1e7-814d9526e0e0"></audio>

    <div id="auth-area" class="card">
        <h2>GİRİŞ YAP</h2>
        <input type="text" id="user" placeholder="Kullanıcı Adı">
        <input type="password" id="pass" placeholder="Şifre">
        <button onclick="login()">GİRİŞ</button>
        <button onclick="register()" style="background: #444; color: white;">KAYIT OL</button>
    </div>

    <div id="app-area">
        <h1 id="welcome-msg"></h1>
        <div class="card">
            <h3>Emirler</h3>
            <input type="text" id="gorevInput" placeholder="Emir ver...">
            <button onclick="gorevEkle()">GÖNDER</button>
            <ul id="liste"></ul>
        </div>
        <button onclick="logout()" style="background: red; color: white;">SİSTEMDEN ÇIK</button>
    </div>

    <script>
        const API_URL = "https://benim-ilk-apim.onrender.com"; // BURAYI DEĞİŞTİR
        let TOKEN = localStorage.getItem("vader_token");

        function playSound(id) { document.getElementById(id).play(); }

        async function register() {
            const u = document.getElementById("user").value;
            const p = document.getElementById("pass").value;
            await fetch(`${API_URL}/register?username=${u}&sifre=${p}`, { method: 'POST' });
            alert("Kayıt başarılı! Şimdi giriş yap.");
        }

        async function login() {
            const u = document.getElementById("user").value;
            const p = document.getElementById("pass").value;
            const formData = new FormData();
            formData.append("username", u);
            formData.append("password", p);

            const res = await fetch(`${API_URL}/token`, { method: 'POST', body: formData });
            if(res.ok) {
                const data = await res.json();
                TOKEN = data.access_token;
                localStorage.setItem("vader_token", TOKEN);
                playSound("sndSaberOn");
                baslat();
            } else { alert("Hatalı giriş!"); }
        }

        function baslat() {
            document.getElementById("auth-area").style.display = "none";
            document.getElementById("app-area").style.display = "block";
            document.getElementById("welcome-msg").innerText = `Hoş geldin Lord ${localStorage.getItem("vader_user") || 'Vader'}`;
            listele();
        }

        async function listele() {
            const res = await fetch(`${API_URL}/listele/`, { headers: { 'Authorization': `Bearer ${TOKEN}` } });
            const veriler = await res.json();
            const l = document.getElementById("liste");
            l.innerHTML = "";
            veriler.forEach(g => l.innerHTML += `<li>${g.baslik}</li>`);
        }

        async function gorevEkle() {
            const b = document.getElementById("gorevInput").value;
            await fetch(`${API_URL}/ekle/?baslik=${b}`, { 
                method: 'POST', 
                headers: { 'Authorization': `Bearer ${TOKEN}` } 
            });
            playSound("sndSaberSwing");
            document.getElementById("gorevInput").value = "";
            listele();
        }

        function logout() {
            localStorage.clear();
            location.reload();
        }

        if(TOKEN) baslat(); // Zaten giriş yapılmışsa direkt aç
    </script>
</body>
</html>


